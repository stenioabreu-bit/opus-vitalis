<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Teams Test</title>
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <div class="container">
        <h1>Manual Teams Service Test</h1>
        <div id="testResults"></div>
        <button id="runTest">Run Test</button>
    </div>

    <script src="scripts/utils.js"></script>
    <script src="scripts/data-loader.js"></script>
    <script src="scripts/auth.js"></script>
    <script src="scripts/reports.js"></script>
    <script src="scripts/teams.js"></script>
    <script>
        async function runManualTest() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<h2>Running Tests...</h2>';
            
            try {
                const teamsService = new TeamsService();
                
                // Test 1: Leader access to team reports
                console.log('Testing leader access...');
                const leaderResult = await teamsService.getTeamReports('user_005'); // Maria Oliveira
                console.log('Leader result:', leaderResult);
                
                // Test 2: Permission check
                const permissionResult = await teamsService.checkPermissions('user_005', 'user_004', 'view');
                console.log('Permission result:', permissionResult);
                
                // Test 3: Non-leader access
                const agentResult = await teamsService.getTeamReports('user_004'); // Pedro Santos (agent)
                console.log('Agent result:', agentResult);
                
                // Test 4: Team hierarchy
                const hierarchyResult = await teamsService.getTeamHierarchy('user_005');
                console.log('Hierarchy result:', hierarchyResult);
                
                resultsDiv.innerHTML = `
                    <h2>Test Results:</h2>
                    <h3>1. Leader Access to Team Reports:</h3>
                    <pre>${JSON.stringify(leaderResult, null, 2)}</pre>
                    
                    <h3>2. Permission Check (Leader -> Team Member):</h3>
                    <pre>${JSON.stringify(permissionResult, null, 2)}</pre>
                    
                    <h3>3. Non-Leader Access (Should Fail):</h3>
                    <pre>${JSON.stringify(agentResult, null, 2)}</pre>
                    
                    <h3>4. Team Hierarchy:</h3>
                    <pre>${JSON.stringify(hierarchyResult, null, 2)}</pre>
                `;
                
                // Determine if tests passed
                const testsPassed = 
                    leaderResult.success && 
                    permissionResult.hasPermission && 
                    !agentResult.success && 
                    hierarchyResult.success;
                
                if (testsPassed) {
                    resultsDiv.innerHTML += '<h2 style="color: green;">✅ All tests passed!</h2>';
                } else {
                    resultsDiv.innerHTML += '<h2 style="color: red;">❌ Some tests failed!</h2>';
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `<h2 style="color: red;">Error: ${error.message}</h2>`;
                console.error('Test error:', error);
            }
        }
        
        document.getElementById('runTest').addEventListener('click', runManualTest);
    </script>
</body>
</html>